---
title: "p8105_hw3_jy3186"
author: "Jiayi Yang"
date: "2022-10-11"
output: github_document
---

```{r}
library(tidyverse)
library(dplyr)
library(rnoaa)
library(ggridges)
```
##Problem 2
load and tidy the data 
```{r}
accel_data = read_csv("./accel_data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    weekday_weekend = ifelse(day %in% c("Saturday","Sunday"), "Weekend", "Weekday"),
    day_id = as.integer(day_id),
    week = as.integer(week)
  ) %>% 
  relocate(weekday_weekend)
accel_data
```
There are `r nrow(accel_data)` observations and `r ncol(accel_data)` variables.
There are four date variables `weekday_weekend`, `week`, `day_id` and `day`; and 1440 variables of activity observations.

aggregate activities and make a plot to show the trend
```{r}
accel_data %>% 
  group_by(day_id) %>% 
  mutate(
    activity_total =  sum(across(activity_1:activity_1440), na.rm = TRUE),
    activity_total = as.integer(activity_total)
  ) %>% 
  select(week, day, day_id, activity_total) %>% 
  ggplot(aes(x = day_id, y = activity_total, color = day)) + 
    geom_point() + geom_line() + 
    theme(legend.position = "bottom")
```
Make a single-panel plot that shows the 24-hour activity time courses for each day
```{r}
accel_eachday = accel_data %>% 
  select(day_id, day, week, activity_1:activity_1440) %>% 
  pivot_longer(activity_1:activity_1440, names_to = "activity_min", values_to = "activity_value") %>% 
  separate(activity_min, c( NA, "activity"), sep = "_") %>% 
  mutate(
    activity = as.integer(activity)
  ) %>% 
  ggplot(aes(x = activity, y = activity_value, color = day), se = FALSE) + 
    geom_point() + geom_line(alpha = .5) + geom_smooth(aes(group = day), se = FALSE) +
    labs(
    title = "24-hour activity plot for each day",
    x = "minute",
    y = "activity value at the minute"
  ) + 
    theme(legend.position = "bottom")
accel_eachday
```
##Problem 3
load data from web
```{r}
library(p8105.datasets)
data("ny_noaa")
ny_noaa_df = 
  ny_noaa %>%
    janitor::clean_names() %>% 
  drop_na(tmax, tmin)%>% 
 mutate(
    tmax = as.integer(tmax),
    tmin = as.integer(tmin)
  ) %>% 
  separate(date, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  )
ny_noaa_df

```
The data has weather information from 1981/1/1 to 2010/12/31, with variables such as prcp, snow, snwd, tmax, and tmin.


count snowfall
```{r}

ny_noaa_df %>% 
  count(snow, na.rm = TRUE) %>% 
  arrange(desc(n))
```
The most observed snowfall value is 0 with a 1167149 frequency of happening. Because there is usually no snow in most days of a year.

### January and July average max temperature
```{r, message= FALSE}
Jan_July_df = ny_noaa_df %>% 
  filter(month == 1 | month == 7) %>% 
  group_by(id, month, year) %>% 
  mutate(tmax_mean = mean(tmax, na.rm = TRUE),
         tmax_mean = as.integer(tmax_mean)) %>% 
  summarize(tmax_mean)

Jan_July_df
ggplot(Jan_July_df, aes(x = year, y = tmax_mean), color = month) +
 geom_point() + geom_line(alpha = .5) + geom_smooth(aes(group = month), se = FALSE) +
  labs(
    title = "Average Max temperature of Jan and July from 1980 to 2010",
    x = "Year",
    y = "Average max temperature"
  ) + 
    theme(legend.position = "bottom") +
  facet_grid(. ~month)

```
There are several outliers in both January and July average max temperatures. The observable structure for Janurary is wavy and for July is more toward a line (more linear).

## Make a two-panel plot showing (i) tmax vs tmin for the full dataset (note that a scatterplot may not be the best option); 
```{r}
tmax_vs_tmin = 
  ny_noaa_df %>% 
  drop_na(tmax, tmin) %>% 
  select(id, year, month, day, tmax, tmin) %>% 
  ggplot(aes(x = tmin, y = tmax)) + geom_line(aes(color = year), alpha = .5) +
  labs(
    title = "Temperature max vs min from 1980 to 2010",
    x = "tmin",
    y = "tmax"
  ) + 
    theme(legend.position = "bottom")

tmax_vs_tmin
```
## Make a plot showing the distribution of snowfall values greater than 0 and less than 100 separately by year
```{r}
snowfall_plot =
  ny_noaa_df %>% 
  select(id, year, month, day, snow) %>% 
  filter(snow > 0 & snow < 100) %>% 
  ggplot(aes(x= snow, fill = year)) +
  geom_density(color = "blue", alpha = .5) +
    labs(
    title = "Snowfall distribution (0-100) from 1980 to 2010",
    x = "snowfall",
    y = "snowfall density"
  ) + 
    theme(legend.position = "bottom")


snowfall_plot
```


